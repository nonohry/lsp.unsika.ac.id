function createFilterableList(e){function t(){c(),r(),l()}function r(){n(),a()}function n(){var e=u();I.selectAll(".filter-tag-item").classed("active",function(e){return k.includes(e)}).classed("teal",function(e){return k.includes(e)}).html(function(t){return t+' <span class="tag-count">'+(e[t]||0)+"</span>"})}function a(){var e=_.selectAll(".filtered-list-super-group").data(p,function(e){return e.id});e.exit().remove();var t=e.enter().append("div").attr("class","filtered-list-super-group");t.append("h2").attr("class","ui header").attr("id",function(e){return e.id}).text(function(e){return e.header}),t.append("div").attr("class","filtered-list-super-group-items"),t.merge(e).select(".filtered-list-super-group-items").each(function(e){var t=d3.select(this);i(e.groupedItems,t,e)}),p.length?P.style("display","none"):P.style("display","")}function i(e,t,r){var n=t.selectAll(".filtered-list-group").data(e,function(e){return e.key});n.exit().remove();var a=n.enter().append("div").attr("class","filtered-list-group"),i=Object.assign({__null:"Other"},r.groupByLabels);a.append("h3").attr("class","ui header").text(function(e){var t=i[e.key];return null==t?e.key:t});a.append("ul").attr("class","filtered-list-group-list "+(x||""));var l=a.merge(n).select("ul").selectAll(".filtered-list-item").data(function(e){return e.values},function(e){return e.id});l.exit().remove(),l.enter().append("li").attr("class","filtered-list-item").merge(l).html(y)}function l(){var e=b.length?encodeURIComponent(b):void 0,t=k.length?encodeURIComponent(k.join("__")):void 0,r=window.location.href;r=updateQueryParam(r=updateQueryParam(r,"q",e),"tags",t),window.history.replaceState({encodedInputString:e,encodedTags:t},"",r)}function u(){return f.reduce(function(e,t){return t[v]&&t[v].forEach(function(t){null==e[t]?e[t]=1:e[t]+=1}),e},{})}function c(){f=w.filter(s).filter(o),p=m.map(function(e){var t=e.items.filter(s).filter(o),r=e.groupBy||h,n=d3.nest().key(function(e){return null==e[r]?"__null":e[r]}).entries(t).sort(function(e,t){return t.key-e.key});return Object.assign({},e,{groupedItems:n})}).filter(function(e){return e.groupedItems.length>0})}function s(e){if(!k.length)return!0;var t=e[v];return Array.isArray(t)||(t=[t]),k.every(function(e){return t.includes(e)})}function o(e){if(!b.trim().length)return!0;var t=["html","id"];return Object.keys(e).filter(function(e){return!t.includes(e)}).map(function(t){return e[t]}).join("\n").toLowerCase().includes(b.trim().toLowerCase())}function d(e){b=e,t()}var f,p,g=e.rootSelector,m=(e.title,e.data),v=e.tagKey,h=e.groupBy,y=e.renderItem,x=e.listClass,b="",k=[],w=m.reduce(function(e,t){return e.concat(t.items)},[]),A=function(e){var t={};return e.forEach(function(e){var r=e[v];null!=r&&(Array.isArray(r)?r.forEach(function(e){t[e]=!0}):t[r]=!0)}),Object.keys(t).sort()}(w);!function(){var e=getUrlQueryParams();b=e.q||"",k=e.tags?e.tags.split("__"):[]}();var O=d3.select(g),I=(O.append("div").attr("class","ui input").append("input").attr("type","text").attr("class","filter-input").attr("placeholder","Search...").attr("value",b).on("change keyup",function(){d(this.value)}),O.append("div").attr("class","filter-tags"));I.append("div").attr("class","filter-label").text("Filter by Tag"),I.selectAll("a").data(A).enter().append("a").attr("class","filter-tag-item ui label").on("click",function(e){-1!==k.indexOf(e)?k.splice(k.indexOf(e),1):k.push(e),t()}).classed("active",function(e){return k.includes(e)}).classed("teal",function(e){return k.includes(e)}).text(function(e){return e});var P=O.append("p").attr("class","empty-message").text("No publications match the current filters.").style("display","none"),_=O.append("div").attr("class","filtered-list");t()}function clearContents(e){d3.select(e).html("")}function updateQueryParam(e,t,r){var n=new RegExp("([?&])"+t+"=.*?(&|#|$)","i");if(void 0===r)return e.match(n)?e.replace(n,"$1$2").replace(/&+/g,"&").replace(/&$/,"").replace(/\?$/,""):e;if(e.match(n))return e.replace(n,"$1"+t+"="+r+"$2");var a="";return-1!==e.indexOf("#")&&(a=e.replace(/.*#/,"#"),e=e.replace(/#.*/,"")),e+(-1!==e.indexOf("?")?"&":"?")+t+"="+r+a}function getUrlQueryParams(){var e,t=/\+/g,r=/([^&=]+)=?([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(t," "))},a=window.location.search.substring(1);for(urlParams={};e=r.exec(a);)urlParams[n(e[1])]=n(e[2]);return urlParams}
